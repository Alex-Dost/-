# DML
---
---
### Что такое DML  
- DML, или Data Manipulation Language, – это подмножество SQL (Structured Query Language), которое используется для управления данными в базах данных. 

### Список команд  
В Data Manipulation Language (DML) существуют несколько ключевых команд, которые используются для работы с данными в базе данных:

- INSERT – добавляет новые записи в таблицу.

   _Пример:_
   
   ```SQL
  INSERT INTO таблица (колонка1, колонка2) VALUES (значение1, значение2);
   ```
   

- UPDATE – обновляет существующие записи в таблице.

   _Пример:_
   
   ```SQL
  UPDATE таблица SET колонка1 = значение1 WHERE условие;
   ```
   

- DELETE – удаляет записи из таблицы.

   _Пример:_
   
   ```SQL
  DELETE FROM таблица WHERE условие;
   ```
   

- SELECT – извлекает данные из таблицы.

   _Пример:_
   
   ```SQL
  SELECT колонка1, колонка2 FROM таблица WHERE условие;
   ```
   

- MERGE – комбинирует операции вставки и обновления, чтобы синхронизировать данные.

   _Пример:_
   
   ```SQL
   MERGE INTO целевая_таблица USING источник ON (условие)
   WHEN MATCHED THEN UPDATE SET колонка1 = значение1
   WHEN NOT MATCHED THEN INSERT (колонка1) VALUES (значение1);
   ```
   
### Нюансы  
- **Транзакции**  
   При выполнении операций DML важно использовать транзакции для обеспечения целостности данных. Транзакции позволяют сгруппировать несколько команд в одну логическую единицу работы. Это предотвращает потерю данных в случае ошибки.

- **Проверка условий**  
   Для операций UPDATE и DELETE особенно важно правильно задавать условия. Неправильное или отсутствующее условие может привести к изменению или удалению всех записей.

- **Индексы**  
   Использование индексов может значительно улучшить производительность команд SELECT, однако может замедлить выполнения операций INSERT, UPDATE и DELETE, так как индексы необходимо обновлять.

- **Уровень изоляции**  
   Уровень изоляции транзакций влияет на видимость изменений, сделанных другими транзакциями. Различные уровни изоляции (Read Uncommitted, Read Committed, Repeatable Read, Serializable) определяют, как и когда транзакции видят изменения.

- **SQL инъекции**  
   При работе с DML важно защищать запросы от SQL инъекций. Использование параметризированных запросов и подготовленных операторов снижает риск атак.

- **Возврат ошибок**  
   Следует поймать и обработать ошибки, возникающие при выполнении DML-команд. Это поможет предотвратить неожиданное поведение приложения.

- **Обновление нескольких строк**  
   При использовании UPDATE следует помнить, что можно обновить сразу несколько строк, если условие возвращает несколько записей.

### Список вопросов с собеседования
    
# DDL
---
---

### Что такое DDL  
- DDL (Data Definition Language) - это язык определения данных, который используется для описания структуры базы данных. Он включает набор команд, которые позволяют создавать, изменять и удалять структуру баз данных и их объектов.

### Список команд  
- CREATE - Используется для создания новых объектов базы данных, таких как таблицы, индексы и представления.

   _Пример:_
   
   ```SQL
   CREATE TABLE имя_таблицы (
       колонка1 тип_данных,
       колонка2 тип_данных
   );
   ```
   
- ALTER - Позволяет изменять существующие объекты базы данных, такие как добавление или удаление колонок в таблице.

   _Пример:_
   
   ```SQL
  ALTER TABLE имя_таблицы ADD колонка3 тип_данных;
   ```
   
- DROP - Удаляет существующие объекты базы данных. Будьте осторожны, так как эта команда уничтожает все данные в объекте.

   _Пример:_
   
  ```SQL
  DROP TABLE имя_таблицы;
  ```
   

- TRUNCATE - Используется для удаления всех записей из таблицы, но структура таблицы остается. Это действие обычно быстрее, чем DELETE, потому что оно не регистрирует каждую строку.

   _Пример:_
   
   ```SQL
  TRUNCATE TABLE имя_таблицы;
   ```
   

- RENAME - Позволяет переименовывать объекты базы данных, такие как таблицы и колонки.

   _Пример:_
   
   ```SQL
  RENAME TABLE старое_имя TO новое_имя;
   ```
   
### Нюансы  
- **Проблемы с производительностью**  
Изменение структуры базы данных с большими таблицами может занять много времени и вызвать блокировки. Всегда стоит планировать операции DDL так, чтобы они выполнялись в менее загруженные часы.

- **Восстановление данных**  
Команды DDL, такие как DROP и TRUNCATE, необратимы. Важно всегда делать резервные копии критических данных перед выполнением таких операций.

- **Ограничения и зависимости**  
Когда вы изменяете структуру таблицы, необходимо учитывать зависимости, такие как внешние ключи и триггеры. Это может потребовать предварительного удаления или изменения определенных объектов.

- **Атомарные операции**  
В большинстве систем управления базами данных (СУБД) операции DDL не являются атомарными. Например, если операция изменения структуры таблицы завершится ошибкой, может возникнуть непредсказуемое состояние.

- **Индексы**  
Создание и изменение индексов с помощью DDL также может повлиять на производительность запросов. Необходимо тщательно продумывать, какие индексы необходимо создать или удалить.

- **Различия между СУБД**  
Синтаксис и возможности DDL могут различаться в зависимости от используемой СУБД (например, MySQL, PostgreSQL, SQL Server). Всегда проверяйте документацию для конкретной СУБД для получения точной информации.

- **Логи и аудит**  
Некоторые СУБД могут не записывать все операции DDL в логи. Это стоит учитывать в контексте аудита и безопасности данных.

- **Параметры безопасности**  
Управление доступом к командам DDL важно для предотвращения несанкционированных изменений в структуре базы данных. Используйте роли и привилегии для ограничения доступа.

- **Версии схемы**  
Поддержание версии схемы базы данных может быть полезным для отката изменений и отслеживания изменений на разных этапах разработки.

- **Миграции**  
Использование инструментов для управления миграциями схемы может помочь избежать проблем и значительно упростить процесс обновления структуры базы данных.

### Список вопросов с собеседования
    
# Транзакции
---
---

### Что такое транзакции  
- Транзакции в SQL представляют собой последовательность операций, которые выполняются как единое целое. Транзакция обеспечивает корректность и согласованность данных в базе данных, даже в случае ошибок или сбоев.

### Основные характеристики транзакций

- **Атомарность**  
   Все операции в транзакции выполняются полностью или не выполняются вообще. Если одна из операций завершилась неудачно, все изменения откатываются.

- **Согласованность**  
   Транзакции переводят базу данных из одного согласованного состояния в другое. Все ограничения и правила целостности данных должны соблюдаться.

- **Изолированность**  
   Изменения, сделанные в рамках одной транзакции, не видны другим транзакциям до тех пор, пока они не будут зафиксированы. Это предотвращает конфликты и несогласованность данных.

- **Долговечность**  
   После успешного завершения транзакции (фактической записи изменений), данные остаются в базе данных, даже в случае сбоя системы.

### Список команд
- BEGIN TRANSACTION – начинает новую транзакцию.
- COMMIT – зафиксировать изменения, сделанные в транзакции.
- ROLLBACK – отменить все изменения, внесенные в текущую транзакцию.

### Примеры использования
```SQL
BEGIN TRANSACTION;
UPDATE accounts SET balance = balance - 100 WHERE account_id = 1;
UPDATE accounts SET balance = balance + 100 WHERE account_id = 2;

Если обе операции успешны, зафиксируем транзакцию
COMMIT;

Если возникла ошибка в одной из операций, отменяем транзакцию
ROLLBACK;
```


### Нюансы
- **Уровни изоляции**
Существуют различные уровни изоляции транзакций, которые определяют, как изменения в одной транзакции могут влиять на другие. Основные уровни изоляции:

- **Время ожидания транзакции**  
Долгие транзакции могут заблокировать ресурсы и приводить к снижению производительности. Важно управлять временем ожидания транзакций, чтобы избежать ситуаций, когда одна транзакция ждет завершения другой.

- **Использование индексов**  
Индексы могут помочь улучшить производительность транзакций, особенно при сложных запросах. Однако неправильное использование индексов может привести к блокировкам и конфликтам.

- **Блокировки**  
SQL-серверы часто используют механизмы блокировок для управления конкурентным доступом к данным. Блокировки могут быть на уровне строк, страниц или объектов, и каждая из них имеет свои преимущества и недостатки.

- **Обработка ошибок**  
При выполнении транзакций важно правильно обрабатывать ошибки. Если возникает ошибка, необходимо использовать команду ROLLBACK, чтобы отменить изменения, чтобы избежать повреждения данных.


### Список вопросов с собеседования
    
    # уровни изоляции
    
Что такое
Список команд
Примеры использования
Нюансы
Список вопросов с собеседования
    
    # SELECT FOR UPDATE

Что такое
Список команд
Примеры использования
Нюансы
Список вопросов с собеседования

    # шардирование

Что такое
Список команд
Примеры использования
Нюансы
Список вопросов с собеседования

    # партиционирование

Что такое
Список команд
Примеры использования
Нюансы
Список вопросов с собеседования

    # репликация

Что такое
Список команд
Примеры использования
Нюансы
Список вопросов с собеседования

    # отпимизация SQL запросов

Что такое
Список команд
Примеры использования
Нюансы
Список вопросов с собеседования
